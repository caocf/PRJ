<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<title></title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">

		<link rel="stylesheet" href="../css/mui.min.css">
		<style>
			.mui-media-body{
				width:100%;
				overflow:hidden;
				white-space:nowrap;
				text-overflow:ellipsis;
				-o-text-overflow:ellipsis;
			}
		</style>
	</head>

	<body>
		<!--下拉刷新容器-->
		<div id="pullrefresh" class="mui-content mui-scroll-wrapper">
			<div class="mui-scroll">
				<!--数据列表-->
				<ul class="mui-table-view mui-table-view-chevron">
					<!--<li class="mui-table-view-cell">-->
						<!--<a href="" class="mui-navigate-right">Item 1</a>-->
					<!--</li>-->
					<!--<li class="mui-table-view-cell">-->
						<!--<a href="" class="mui-navigate-right">Item 2</a>-->
					<!--</li>-->
					<!--<li class="mui-table-view-cell">-->
						<!--<a href="" class="mui-navigate-right">Item 3</a>-->
					<!--</li>-->
					<!--<li class="mui-table-view-cell">-->
						<!--<a href="" class="mui-navigate-right">Item 4</a>-->
					<!--</li>-->
					<!--<li class="mui-table-view-cell">-->
						<!--<a href="" class="mui-navigate-right">Item 5</a>-->
					<!--</li>-->
				</ul>
			</div>
		</div>
		<script src="../js/mui.js"></script>
		<script>
			mui.init({
				pullRefresh: {
					container: '#pullrefresh',
					down: {
						callback: pulldownRefresh
					},
					up: {
						contentrefresh: '正在加载...',
						callback: pullupRefresh
					}
				}
			});
            var count = 0;
			/**
			 * 下拉刷新具体业务实现
			 */
			function pulldownRefresh() {
				setTimeout(function() {
					var table = document.body.querySelector('.mui-table-view');
					//var cells = document.body.querySelectorAll('.mui-table-view-cell');
//					for (var i = cells.length, len = i + 3; i < len; i++) {
//						var li = document.createElement('li');
//						li.className = 'mui-table-view-cell';
//						li.innerHTML = '<a class="mui-navigate-right">Item ' + (i + 1) + '</a>';
//						//下拉刷新，新纪录插到最前面；
//						table.insertBefore(li, table.firstChild);
//					}
					count = 1;
					table.innerText = "";
					getData(count,table);

					mui('#pullrefresh').pullRefresh().endPulldownToRefresh(); //refresh completed
				}, 100);
			}
			/**
			 * 上拉加载具体业务实现
			 */
			function pullupRefresh() {
				setTimeout(function() {
					//mui('#pullrefresh').pullRefresh().endPullupToRefresh((++count > 2)); //参数为true代表没有更多数据了。
					var table = document.body.querySelector('.mui-table-view');
					count++;
                    getData(count,table);
				}, 1500);
			}
			var getData = function (page,table){
			    mui.ajax({
			        type:"GET",
					url:"../wechat/queryPunish.form",
					async:false,
					timeout:30000,
					data:{
			            page:page,
						rows:10
					},
					success:function(data){
						if(data.resultCode.code == 1){
						    var list = data.data;
						    for(var i = 0;i<list.length;i++){
                                var li = document.createElement('li');
                                li.className = 'mui-table-view-cell';
                                var a = document.createElement("a");
                                a.className = "mui-navigate-right";
                                var content = list[i].content;
                                a.innerHTML = '<div class="mui-media-body">'+content+' <p class="mui-ellipsis">'+list[i].date+'</p></div>';
                                li.appendChild(a);
                                li.ref = list[i].url;
                                li.addEventListener("tap",function(){
                                    mui.openWindow({
                                        url: "detail.html",
										id:"detail.html"
                                    });
                                    localStorage.paurl = this.ref;
								});
                                table.appendChild(li);
							}
						}
					},
                    error:function(xhr,type,errorThrown){
                        if(type == "timeout"){
                            mui.toast("网络连接超时，请检查网络链接!");
                        }
                        mui.toast("query error"+JSON.stringify(xhr));
                    }
				});
			}
            mui.ready(function(){
                var table = document.body.querySelector('.mui-table-view');
                count = 1;
                table.innerText = "";
                getData(count,table);
            });
		</script>
	</body>

</html>