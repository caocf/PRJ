<!doctype html>
<html>

	<head>
		<meta charset="UTF-8">
		<title>换乘地图</title>
		<meta name="viewport" content="initial-scale=1.0, user-scalable=no, width=device-width">
		<link href="../css/mui.min.css" rel="stylesheet" />
		<link rel="stylesheet" href="../css/app.css" />
		<link rel="stylesheet" href="http://cache.amap.com/lbs/static/main1119.css" />
		<script type="text/javascript" src="../js/jquery-2.1.0.js"></script>
		<script src="http://cache.amap.com/lbs/static/es5.min.js"></script>
		<script src="http://webapi.amap.com/maps?v=1.3&key=3a1316dfb76f09e882251604b588fdb7"></script>
		<script type="text/javascript" src="http://cache.amap.com/lbs/static/addToolbar.js"></script>
	</head>

	<body>
		<header></header>
		<div class="mui-content" id="container">

		</div>
		<footer></footer>
		<script type="text/javascript" src="../js/mui.min.js"></script>
		<script type="text/javascript" src="../js/app.js"></script>
		<script type="text/javascript">
			document.title = localStorage.startAddress+"->"+localStorage.endAddress
			var gpsstr = localStorage.trasferGPS
			var startend = JSON.parse(localStorage.trasferData)
			var gps = JSON.parse(gpsstr);
			console.log(gpsstr)
			var map = new AMap.Map("container", {
				resizeEnable: true,
				center: [startend.startLontitude, startend.startLantitude],
				zoom: 13
			});
			var lineGps = [];
			var start = app.convert([
				[startend.startLontitude, startend.startLantitude]
			])
			var markStart = new AMap.Marker({
				icon: "../image/Icon_start.png",
				position: start[0],
				offset : new AMap.Pixel(-19,-52)
			});
			markStart.setMap(map);
			var end = app.convert([
				[startend.endLontitude, startend.endLantitude]
			]);
			var markEnd = new AMap.Marker({
				icon: "../image/Icon_end.png",
				position: end[0],
				offset : new AMap.Pixel(-19,-52)
			});
			markEnd.setMap(map);
			for(var i = 0; i < gps.length; i++) {
				if(gps[i].LineTrailsList != null && gps[i].LineTrailsList.length > 0) {
					for(var j = 0; j < gps[i].LineTrailsList.length; j++) {
						var t = [];
						t.push(gps[i].LineTrailsList[j].Longitude)
						t.push(gps[i].LineTrailsList[j].Latitude)
						lineGps.push(t)
					}
				}else{
					var temp = []
					temp.push(gps[i].Longitude);
					temp.push(gps[i].Latitude);
					lineGps.push(temp);
				}
			}
			var lineArr = []
			lineArr.push(start[0])
//			app.convert(lineGps, function(data) {
//				if(data.status == 1) {
//					var locations = data.locations;
//					var lcList = locations.split(";");
//					var point;
//					for(var i = 0; i < lcList.length; i++) {
//						point = lcList[i].split(",");
//						lineArr.push(point);
//					}
//				}
//
//			});
			var tlist = app.convert(lineGps)
			for(var i = 0;i<tlist.length;i++){
				lineArr.push(tlist[i])
			}
			console.log(lineArr)
			setTimeout(function(){
				lineArr.push(end[0])
				var polyline = new AMap.Polyline({
				path: lineArr, //设置线覆盖物路径
				strokeColor: "#3366FF", //线颜色
				strokeOpacity: 1, //线透明度
				strokeWeight: 3, //线宽
				strokeStyle: "solid", //线样式
				strokeDasharray: [10, 5] //补充线样式
			});
			polyline.setMap(map);
			},1000);
			
		</script>
	</body>

</html>